# 一、波段交易信息处理器

该项目用于解析特定格式的文本交易记录，并将其转换为结构化的Excel文件。通过对文本中的交易信息进行提取、解析，生成符合格式要求的Excel文件，以便后续分析与处理。

## 功能介绍

1. **文本解析**：
   - 该工具能够从一行或多行文本中提取出多个交易字段，包括但不限于：
     - 组合类型
     - 交易对手
     - 债券代码
     - 交易方向
     - 到期收益率
     - 交易面额
     - 清算速度

2. **自动化处理**：
   - 代码会根据文本中的特征（如交易方向、到期收益率等）自动解析相关信息。
   - 对于无法解析的字段，代码会进行默认处理或者跳过。

3. **Excel导出**：
   - 最终的交易记录会被转换为一个 Excel 文件，并根据当前日期自动命名文件，格式为 `【YYYY-MM-DD】波段交易2_tradername.xlsx`,tradername为交易员名称，可以自己设置。

## 函数定义
1. **parse_line(line) 函数**:
   - 该函数将每一行的交易数据解析成一个字典，字典中包含多个交易字段，如交易对手、债券代码、到期收益率等。
   - 通过正则表达式处理不同的信息，如债券代码、交易方向、到期收益率等。
   - parse_line 解析的字段包括：组合类型、组合名称、内部证券账户代码、交易对手、对手交易员、执行市场、交易日期、交易方向、债券代码、交易面额、清算速度、首期净价、到期收益率、行权收益率、执行员等。
   - 如果某些信息无法在当前行中找到，程序会进行默认处理或跳过。
2. **process_input_to_excel(input_text, output_excel) 函数**:
   - 这个函数接收一个包含多行交易记录的字符串 input_text，并逐行调用 parse_line() 来解析每一行的交易信息。
   - 解析后的信息存入一个 DataFrame 中，并最终输出为一个 Excel 文件。文件名包含当前日期，格式为 【YYYY-MM-DD】波段交易2_tradername.xlsx。

## 使用方法
1. **安装依赖**：
   本项目依赖 `pandas` 库用于处理数据和生成Excel文件。如果你没有安装 `pandas`，可以通过以下命令安装：
   
   ```bash
   pip install pandas
2. **要素输入**
   - 下面我们进行一个样例测试，使用如下的交易要素
   ```bash
   2400006 1.8725 1000 +0 北京证券 to 北京银行  发王五
   2400006 1.8725 3000 +0 北京证券 to 南京银行 发王七
   2400006 1.875  1000 +0 东京银行 to 北京证券 发南京银行 王六 
   230023 1.95  2000  +0 北京基金 出给 北京证券,发北京证券 张三
   ```
- 贴入代码相应位置后，代码会自动输出xls文件
- 在这个样例中，输出应当为：
<img width="1508" height="172" alt="image" src="https://github.com/user-attachments/assets/78a696c2-d9ba-444a-b3dc-4168aae3f7a6" />


# 二、债券回购交易数据解析器

## 📖 项目简介
本项目提供一个 **Python 脚本**，用于将原始的债券回购交易文本自动解析，并整理成标准化的 Excel 表格。  
脚本支持提取交易要素（交易日期、利率、天数、交易金额、交易对手、债券信息等），并分别生成两份 Excel 文件，便于后续统计、复核和对账使用。  

该工具尤其适合券商/交易员处理 **质押式回购**、**债券交易流水** 等场景，减少手工录入和整理的工作量。

---

## ⚙️ 功能说明
- **文本解析**  
  从原始交易文本（包含债券代码、评级、利率、期限等信息）中自动提取交易要素。
- **到期日计算**  
  根据回购期限自动计算到期结算日期，且仅落在工作日（跳过节假日/周末）。
- **债券明细提取**  
  自动解析出交易涉及的债券代码、券面总额、折价率等信息。
- **Excel 输出**  
  - 文件1：`xxxx-信用.xlsx` —— 交易明细（包含内部字段、债券明细）  
  - 文件2：`xxxx-回购前台信用.xlsx` —— 回购交易前台格式（便于业务使用）  
  - 文件名自动按当天日期生成（`MMDD-xxx.xlsx`）

---

## 📂 输出文件结构

### 文件1：`信用.xlsx`
包含字段：
- 交易基础信息（交易员、对手方、市场、日期、方向等）
- 回购参数（利率、天数、到期日、金额等）
- 债券质押信息（支持最多 15 支债券：代码、券面金额、折价率）

### 文件2：`回购前台信用.xlsx`
包含字段：
- 本方/对手方信息
- 回购方式、期限、利率
- 交易金额、利息、到期结算金额
- 债券明细（代码、简称、金额、折算比例等）

---
